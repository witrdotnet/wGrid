<html>
	<head>
		<link rel="stylesheet" type="text/css" href="wGrid.css" /> 
		<style>
			.gridValueCellChecked{
				background:	url('./images/grid_check.png') 50% 50% no-repeat #898686;	
			}

			.gridValueCellMiChecked{
				background:	url('./images/grid_check.png') 50% 50% no-repeat #B4ADA6;
			}

			.gridValueCellDisabled{
				background : url('./images/grid_disabled.png') 50% 50% no-repeat;
				cursor : pointer;
			}

			.cell-dis{
				background-color: #BBD400;
				color: black;
				font-family: arial, helvetica, sans-serif;
				font-size: 11px;
				font-style: normal;
				font-variant: normal;
				font-weight: bold;				
				width:70px;				
				text-overflow:ellipsis;
				overflow:hidden;
				margin: 0px;
				padding : 0px;
			}

		</style>
		<script charset="utf-8" src="./prototype.js" type="text/javascript"></script>	
		<script charset="utf-8" src="./scriptaculous.js" type="text/javascript"></script>	
		<script charset="utf-8" src="./wConsole.js" type="text/javascript"></script>	
		<script charset="utf-8" src="./wGrid.js" type="text/javascript"></script>	
	</head>
	<body>
		<table>
			<tr> 
				<td>filter on columns :</td> <td width="300px"><input type=text id='filterColsText' /></td> 
				<td rowspan =2></td>
			</tr>			
			<tr style='vertical-align:top;'> 
				<td>filter on rows :</td> <td><input type=text id='filterRowsText' /></td>
			</tr>
			
		</table>
	
		<div id ='cont'></div>
		
		<ul>
			<li>use direction keys to navigate on grid</li>
			<li><div class='gridvaluetd' style="width:20px;height:20px;display:inline-block;margin:2px 4px 2px 0px;">&nbsp;</div>unchecked cell</li>
			<li><div class='gridValueCellDisabled' style="width:20px;height:20px;display:inline-block;margin:2px 4px 2px 0px;">&nbsp;</div>disabled cell (fragment not delegated in parent delegation)</li>
			<li><div class='gridValueCellChecked' style="width:20px;height:20px;display:inline-block;margin:2px 4px 2px 0px;">&nbsp;</div>checked cell (fragment will be delegated in current delegation)</li>
			<li><div class='gridValueCellMiChecked' style="width:20px;height:20px;display:inline-block;margin:2px 4px 2px 0px;">&nbsp;</div>partially checked (list is collapsed while not all fragments in list have been checked)</li>						
		</ul>						

		<script language = "javascript">
			function getRandomName(){
				return getFixedLengthRandomName(5);
			}
			
			function getFixedLengthRandomName(charsCount){
				return getVariableLengthRandomName(charsCount,charsCount);
			}
			
			function getVariableLengthRandomName(minChars, maxChars){
				name = '';
				charsCount = getRandomInt(minChars, maxChars);
				for(j=0; j<charsCount; j++){
					var randomnumber=Math.floor(Math.random()*25)+65
					name = name + String.fromCharCode(randomnumber);
				}
				return name;
			}
			
			function getRandomInt(min,max){
				return Math.floor(Math.random()*(max-min))+min;
			}

		
			minColsListsCount = 1;
			maxColsListsCount = 1;
			
			minRowsListsCount = 1;
			maxRowsListsCount = 1;
			
			minValuesInLists = 50;
			maxValuesInLists = 50;
			
			minColsValuesCount = 0;
			maxColsValuesCount = 0;
			
			minRowsValuesCount = 0;
			maxRowsValuesCount = 0;
			
			disValuesCount = 100;
			alreadySelectedValuesCount = 100;
			
			visibleCols = 8;
			visibleRows = 10;
		
			var colsList = new Array();
			var rowsList = new Array();
			var disabledValuesList = new Array();
			var alreadySelectedValuesList = new Array();
			
			// append cols lists
			colsListsCount = getRandomInt(minColsListsCount, maxColsListsCount);
			valId = 0;
			for(i =1; i<=colsListsCount;i++) {
				valuesList = new Array();
				valuesListCount = getRandomInt(minValuesInLists,maxValuesInLists);
				for(v =1; v<=valuesListCount;v++) {
					valId++;
					valueName = getRandomName();
					valuesList.push({type:'VALUE', key:valId, name:valueName +"("+valId+")"});					
				}			
				listName = getRandomName();
				colsList.push({type:'LIST', key:i, name:listName +"("+i+")", elements : valuesList, collapsed:false});
			}
			
			// append cols values(without lists)
			colsValuesCount = getRandomInt(minColsValuesCount, maxColsValuesCount);
			for(v =1; v<=colsValuesCount;v++) {
				valId++;
				valueName = getRandomName();
				colsList.push({type:'VALUE', key:valId, name:valueName +"("+valId+")"});					
			}			
			
			// memorize max col id 
			maxColId = valId;
			
			// append rows lists
			rowsListsCount = getRandomInt(minRowsListsCount, maxRowsListsCount);
			valId = 0;
			for(i =1; i<=rowsListsCount;i++) {
				valuesList2 = new Array();
				valuesListCount = getRandomInt(minValuesInLists,maxValuesInLists);				
				for(v =1; v<=valuesListCount;v++) {
					valId++;
					valueName = getRandomName();
					valuesList2.push({type:'VALUE', key:valId, name:valueName +"("+valId+")"});					
				}			
				listName = getRandomName();
				rowsList.push({type:'LIST', key:i, name:listName +"("+i+")", elements : valuesList2, collapsed:false});
			}
			
			// append rows values(without lists)
			rowsValuesCount = getRandomInt(minRowsValuesCount,maxRowsValuesCount);
			for(v =1; v<=rowsValuesCount;v++) {
				valId++;
				valueName = getRandomName();
				rowsList.push({type:'VALUE', key:valId, name:valueName +"("+valId+")"});					
			}			
			
			// memorize max row id 
			maxRowId = valId;
			
			// disabled values			
			for(d=1; d<=disValuesCount;d++){
				disColId = getRandomInt(1,maxColId);
				disRowId = getRandomInt(1,maxRowId);
				personHavingFrag = null;
				if(getRandomInt(1,10) > 5) personHavingFrag = getVariableLengthRandomName(5,10) + ' ' + getVariableLengthRandomName(5,10);
				disabledValuesList.push({colId : disColId, rowId : disRowId, alreadyDelegatedTo : personHavingFrag});
			}
			
			// already selected values			
			for(d=1; d<=alreadySelectedValuesCount;d++){
				selColId = getRandomInt(1,maxColId);
				selRowId = getRandomInt(1,maxRowId);
				disabled = false;
				disabledValuesList.each(
					function(disVal){
						if(disVal.colId == selColId && disVal.rowId == selRowId){
							disabled = true;
							throw $break;
						}
					}
				);
				if(!disabled) alreadySelectedValuesList.push({colId : selColId, rowId : selRowId});
			}
			
			// define customized user grid ctrl
			var GinUserCtrl = Class.create({	
				onCreateCell: function(elemTd,cellState){
					person = null;
					if(!cellState.enabled){
						disabledValuesList.each(
							function(disVal){								
								if(disVal.alreadyDelegatedTo){
									if('CV'+disVal.colId + '_RV' + disVal.rowId == elemTd.id){
										person = disVal.alreadyDelegatedTo;
										throw $break;
									}
								}
							}
						);
						if(person){
							elemTd.innerHTML = '';
							if(!elemTd.hasClassName('cell-dis')) elemTd.addClassName('cell-dis');
							elemTd.removeClassName('gridValueCellDisabled');
							elemTd.innerHTML = person;
							console.log(elemTd.id+' delegatedTo : '+person);
						}
					}
				}
			});
			var ginUserCtrl = new GinUserCtrl;
			
			// create Grid with customized gridCtrl
			grid = new WGrid('cont',{
									userGridCtrl : ginUserCtrl,
									data : {cols:colsList, rows:rowsList},
									disabledValues: disabledValuesList,
									alreadySelectedValues: alreadySelectedValuesList,
									grid:{visibleColsCount:visibleCols,visibleRowsCount:visibleRows}
									}
								);
			evtText = false;
			Event.observe($('filterColsText'), 'keyup', function(event){ 				
				grid.filterCols(event.target.value);
				evtText = true;				
			});
			Event.observe($('filterRowsText'), 'keyup', function(event){ 				
				grid.filterRows(event.target.value);
				evtText = true;				
			});
			Event.observe(document, 'keydown', function(event){ 				
				if(!evtText){
					if(event.keyCode == Event.KEY_RIGHT) grid.shiftRight();
					if(event.keyCode == Event.KEY_LEFT) grid.shiftLeft();
					if(event.keyCode == Event.KEY_UP) grid.shiftTop();
					if(event.keyCode == Event.KEY_DOWN) grid.shiftBottom();
				}else{
					evtText = false;
				}
			});
			
		</script>
		
	</body>
</html>